# Data Model: Zotero API Digest

**Date**: 2024-12-30  
**Feature**: 001-zotero-api-digest

## Entities

### LibraryItem

Represents a bibliographic entry from the Zotero library.

**Source**: Zotero API item response (via pyzotero)

**Fields**:
- `key` (string, required): Zotero item key (unique identifier)
- `version` (integer, required): Item version for conflict detection
- `data` (object, required): Item metadata object containing:
  - `title` (string, optional): Item title
  - `itemType` (string, required): Type of item (e.g., "journalArticle", "book", "conferencePaper")
  - `creators` (array, optional): List of creator objects with:
    - `firstName` (string, optional)
    - `lastName` (string, optional)
    - `creatorType` (string, required): e.g., "author", "editor"
  - `date` (string, optional): Publication date (ISO format or partial date)
  - `dateAdded` (string, required): When item was added to library (ISO timestamp)
  - `dateModified` (string, required): Last modification timestamp
  - `abstractNote` (string, optional): Abstract text
  - `publicationTitle` (string, optional): Journal/conference name
  - `url` (string, optional): Item URL
  - `tags` (array, optional): List of tag objects with `tag` (string) field
  - `DOI` (string, optional): Digital Object Identifier

**Validation Rules**:
- `key` must be non-empty string
- `itemType` must be valid Zotero item type
- `dateAdded` must be parseable ISO timestamp for filtering
- Missing optional fields handled gracefully (no validation errors)

**State Transitions**: N/A (read-only from API)

---

### Digest

Represents the generated markdown document containing formatted library items.

**Source**: Generated by application

**Fields**:
- `title` (string): Main digest title (e.g., "Zotero Digest - 2024-12-30")
- `generated_at` (datetime): When digest was generated
- `time_range_days` (integer): Number of days covered (e.g., 1 for 24 hours)
- `item_count` (integer): Number of items included
- `sections` (dict): Organized by item type:
  - Key: item type (e.g., "journalArticle", "book")
  - Value: list of formatted LibraryItem strings

**Validation Rules**:
- `title` must be non-empty
- `item_count` must match sum of items in all sections
- Sections must be non-empty if `item_count` > 0

**State Transitions**: 
- Created → Written to file (immutable after creation)

---

### Configuration

Represents user configuration for the application.

**Source**: Environment variables + CLI arguments

**Fields**:
- `library_id` (string, required): Zotero user/library ID
- `api_key` (string, required): Zotero API key
- `output_path` (string, optional): Output file path (default: "digest.md")
- `days` (integer, optional): Time window in days (default: 1)
- `include_keywords` (list[string], optional): Keywords to include (empty = all)
- `exclude_keywords` (list[string], optional): Keywords to exclude (empty = none)

**Validation Rules**:
- `library_id` and `api_key` must be non-empty (validated at startup)
- `days` must be positive integer
- `output_path` must be valid file path (directory created if needed)
- Keywords are case-insensitive strings

**State Transitions**: 
- Loaded from env → Merged with CLI args → Validated → Used by application

---

## Relationships

- **Configuration** → **LibraryItem**: Configuration determines which items are fetched and how they're filtered
- **LibraryItem** → **Digest**: LibraryItems are transformed and organized into Digest sections
- **Digest** → **File**: Digest is written to markdown file on disk

## Data Flow

```
Configuration (env + CLI)
    ↓
Zotero API (via pyzotero)
    ↓
LibraryItem[] (raw API responses)
    ↓
Filtering (by date, keywords)
    ↓
Sorting (by publication date, limit to 10)
    ↓
Formatting (to markdown strings)
    ↓
Digest (organized by type)
    ↓
Markdown File (written to disk)
```

## Edge Cases

- **Missing publication date**: Items sorted to end of list when applying 10-item limit
- **Missing metadata fields**: Fields omitted from output or shown as "N/A"
- **Empty results**: Digest shows "No items found" message
- **Invalid dates**: Treated as missing, sorted to end
- **Special characters in markdown**: Escaped appropriately (e.g., `#` in titles)

